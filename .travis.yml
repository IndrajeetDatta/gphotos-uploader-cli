language: go
env:
  global:
  - GO111MODULE=on
matrix:
  include:
  - go: 1.x
    env: LATEST=true
  - go: 1.11.x
before_install:
- go get github.com/mitchellh/gox
install:
- 
script:
- diff -u <(echo -n) <(gofmt -d .)
- go vet $(go list ./... | grep -v /vendor/) || true
- go test -v -race ./...
- if [ "${LATEST}" = "true" ]; then gox -os="linux darwin" -arch="amd64" -output="gphotos-uploader-cli.{{.OS}}.{{.Arch}}"
  -ldflags "-X main.BuildRev=`git rev-parse --short HEAD`" -verbose ./...; fi
deploy:
  provider: releases
  skip_cleanup: true
  file:
  - gphotos-uploader-cli.darwin.amd64
  - gphotos-uploader-cli.linux.amd64
  on:
    repo: pacoorozco/gphotos-uploader-cli
    tags: true
    condition: "$LATEST = true"
  api-key:
    secure: baUdTyvTwPsleUPlU0TCBZv9TYKkIQypsjXUVentGcCCCu0QS7HeiecnRSLYumwsQfEEbCYEtgUMVzAtFK+ouiVOH6o0HFmKL5aNXJJJqz3aDI0lKrKTH4/4LMuaaYsL0ufP4t2kyJn7xW9XQWBRfybct5kV0Aro/AdKcBXfHtlz3VRhlQPF6s3bjx5KLz3Gc+QyBKNWpB0Qycchyrgt/hVplyYvTnZLrDpbW8PGnyXIos9/sHlPVWPSftq8cQY13XYqrh4FfZ373gHOOyM6vu+KALFQATYRbdMyOccHWqPg8WWsqwyegF2Ar/2+bqkueL6lUs0zBl9Y3hY13SgNKnAqL5snamW6zVrYv1XPKeTbAkrzMKwCA21q2tyh1yeQaJhfLYonxjpFMXfjOIJY5kXFq4GiDfotr/iO0W0Ps9EtTgsFTTv/CPYvgnRkzUoF0vSKSo8LdpRi7+VxstYLK7a4PS/Sa7JG66RFedIsnXDzX8/4r9RAMCF48SmxZK+NeMIl9lWft66f7arrjX/AXOpOFprWyVr/UWdDwx993pwcu5vw23MluD74EOSoKrMhzQxVt650PCh53R2ANTZMKVVjCib80OgGeKEdrAtAUcKYE1HdN67I9m6WF2p7oEEVdMZQdAgVDOakDt2ZY3CRpdX6QG0zihu+23YKrjQtjKo=
